<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Chevrolet TRACKER LS 2017 | ALTORRA CARS</title>

    <!-- SEO Meta Tags (updated dynamically via JS) -->
    <meta name="description" content="Chevrolet TRACKER LS 2017 - $¬†44.000.000. Usado, Mecanica, 63.079 km. Disponible en ALTORRA CARS, Cartagena.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://altorracars.github.io/vehiculos/chevrolet-tracker-ls-2017-13.html">

    <!-- Open Graph / Facebook / WhatsApp -->
    <meta property="og:type" content="product">
    <meta property="og:url" id="og-url" content="https://altorracars.github.io/vehiculos/chevrolet-tracker-ls-2017-13.html">
    <meta property="og:title" id="og-title" content="Chevrolet TRACKER LS 2017 | ALTORRA CARS">
    <meta property="og:description" id="og-description" content="Chevrolet TRACKER LS 2017 - $¬†44.000.000. Usado, Mecanica, 63.079 km. Disponible en ALTORRA CARS, Cartagena.">
    <meta property="og:image" id="og-image" content="https://firebasestorage.googleapis.com/v0/b/altorra-cars.firebasestorage.app/o/cars%2F1771108172890_Dise_o_sin_t_tulo__3__compressed.webp?alt=media&amp;token=fe5b13c6-ca53-4055-bb84-3d1e205deb97">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="ALTORRA CARS">
    <meta property="og:locale" content="es_CO">
    <meta property="product:price:amount" id="og-price" content="">
    <meta property="product:price:currency" content="COP">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="tw-title" content="Chevrolet TRACKER LS 2017 | ALTORRA CARS">
    <meta name="twitter:description" id="tw-description" content="Chevrolet TRACKER LS 2017 - $¬†44.000.000. Usado, Mecanica, 63.079 km. Disponible en ALTORRA CARS, Cartagena.">
    <meta name="twitter:image" id="tw-image" content="https://firebasestorage.googleapis.com/v0/b/altorra-cars.firebasestorage.app/o/cars%2F1771108172890_Dise_o_sin_t_tulo__3__compressed.webp?alt=media&amp;token=fe5b13c6-ca53-4055-bb84-3d1e205deb97">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile-fixes.css">
    <link rel="stylesheet" href="css/vehicles-cards-fix.css">
    <link rel="stylesheet" href="css/sidebar-filters-fix.css">
    <link rel="stylesheet" href="css/footer-fixes.css">
    <link rel="stylesheet" href="css/comparador.css">
    <link rel="stylesheet" href="css/historial-visitas.css">
    <link rel="stylesheet" href="css/citas.css">
    <link rel="stylesheet" href="css/animaciones.css">
    <link rel="stylesheet" href="css/dark-theme.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           VEHICLE DETAIL - OPTIMIZED LAYOUT
           ============================================ */

        :root {
            --gold: #b89658;
            --gold-dark: #916652;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-700: #374151;
            --gray-900: #111827;
        }

        /* Container Principal */
        .detail-page {
            margin-top: 96px;
            background: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            max-width: 100vw;
        }

        .detail-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
            box-sizing: border-box;
        }

        /* Grid Principal - Layout Balanceado */
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
            align-items: start;
            max-width: 100%;
            overflow: visible;
        }

        /* ===== GALER√çA OPTIMIZADA ===== */
        .gallery-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-width: 0;
            max-width: 100%;
        }

        .main-image-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/10;
            background: var(--gray-100);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: zoom-in;
            transition: transform 0.3s ease;
        }

        .main-image:hover {
            transform: scale(1.02);
        }

        .image-counter {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(4px);
        }

        /* Thumbnails - Fila Horizontal Compacta */
        .thumbnails-grid {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 4px;
            scrollbar-width: thin;
        }

        .thumbnails-grid::-webkit-scrollbar {
            height: 4px;
        }

        .thumbnails-grid::-webkit-scrollbar-track {
            background: var(--gray-200);
            border-radius: 2px;
        }

        .thumbnails-grid::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 2px;
        }

        .thumbnail {
            flex: 0 0 80px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail:hover,
        .thumbnail.active {
            border-color: var(--gold);
            transform: scale(1.05);
        }

        /* ===== BOTONES DE ACCI√ìN - DISE√ëO SIM√âTRICO ===== */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .btn-action {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.25s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white !important;
            width: 100%;
            box-sizing: border-box;
        }

        .btn-action svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .btn-action span {
            flex: 1;
            text-align: center;
        }

        /* WhatsApp - Bot√≥n Principal Destacado */
        .btn-action.btn-whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            box-shadow: 0 4px 15px rgba(37,211,102,0.3);
        }

        .btn-action.btn-whatsapp:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(37,211,102,0.5);
        }

        /* Calculadora/Cr√©dito */
        .btn-action.btn-calculator {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 4px 15px rgba(59,130,246,0.3);
        }

        .btn-action.btn-calculator:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(59,130,246,0.5);
        }

        /* Fila de botones secundarios (Comparar + Compartir + Agendar) */
        .btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .btn-row .btn-action {
            padding: 12px 8px;
            font-size: 11px;
            overflow: hidden;
            white-space: nowrap;
            min-width: 0;
        }

        .btn-row .btn-action svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .btn-row .btn-action span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Comparar */
        .btn-action.btn-comparar {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            box-shadow: 0 3px 12px rgba(139,92,246,0.3);
        }

        .btn-action.btn-comparar:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(139,92,246,0.5);
        }

        .btn-action.btn-comparar.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 3px 12px rgba(16,185,129,0.4);
        }

        /* Compartir */
        .btn-action.btn-share {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            box-shadow: 0 3px 12px rgba(6,182,212,0.3);
        }

        .btn-action.btn-share:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(6,182,212,0.5);
        }

        /* Agendar */
        .btn-action.btn-agendar {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 3px 12px rgba(245,158,11,0.3);
        }

        .btn-action.btn-agendar:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(245,158,11,0.5);
        }

        /* Share toast/notification */
        .share-toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            z-index: 10000;
            transition: transform 0.3s ease;
            pointer-events: none;
        }
        .share-toast.visible {
            transform: translateX(-50%) translateY(0);
        }

        /* ===== INFO SIDEBAR ===== */
        .info-sidebar {
            position: sticky;
            top: 88px;
            min-width: 0;
            max-width: 100%;
        }

        .info-card {
            background: linear-gradient(180deg, rgba(30,30,30,0.95) 0%, rgba(20,20,20,0.98) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: visible;
            word-wrap: break-word;
        }

        /* Header Info */
        .vehicle-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 14px;
            margin-bottom: 16px;
        }

        .badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.nuevo { background: #10b981; color: white; }
        .badge.destacado { background: var(--gold); color: white; }
        .badge.oferta { background: #ef4444; color: white; }

        .vehicle-title {
            font-size: 20px;
            font-weight: 800;
            line-height: 1.2;
            margin: 0 0 6px;
            color: white;
            /* Override card truncation - never abbreviate in detail view */
            white-space: normal !important;
            overflow: visible !important;
            text-overflow: unset !important;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .vehicle-subtitle {
            font-size: 13px;
            color: rgba(255,255,255,0.6);
            font-weight: 500;
        }

        /* Precio */
        .price-box {
            background: linear-gradient(135deg, rgba(184,150,88,0.2) 0%, rgba(184,150,88,0.1) 100%);
            border: 1px solid rgba(184,150,88,0.3);
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 16px;
        }

        .price-label {
            font-size: 11px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 4px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .price-value {
            font-size: 28px;
            font-weight: 900;
            color: var(--gold);
            line-height: 1;
        }

        .price-normal {
            font-size: 18px;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
            text-decoration: line-through;
            margin-bottom: 4px;
        }

        .price-offer {
            font-size: 30px;
            font-weight: 900;
            color: #ff6b6b;
            line-height: 1;
        }

        /* Quick Specs - Grid Compacto */
        .quick-specs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .spec-item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.08);
            text-align: center;
        }

        .spec-label {
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.3px;
            margin-bottom: 4px;
        }

        .spec-value {
            font-size: 14px;
            font-weight: 700;
            color: white;
        }


        /* ===== TABS CONTENT ===== */
        .content-section {
            grid-column: 1 / -1;
            margin-top: 20px;
            background: rgba(30,30,30,0.5);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            min-width: 0;
            max-width: 100%;
            overflow: hidden;
            box-sizing: border-box;
        }

        .tabs-nav {
            display: flex;
            gap: 4px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            margin-bottom: 24px;
        }

        .tab-btn {
            padding: 12px 20px;
            background: transparent;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            color: var(--gold);
        }

        .tab-btn.active {
            color: var(--gold);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gold);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== FICHA T√âCNICA - TABLA MODERNA ===== */
        .section-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 20px;
            color: white;
            position: relative;
            padding-bottom: 10px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--gold);
            border-radius: 2px;
        }

        .ficha-table {
            display: grid;
            gap: 16px;
        }

        .ficha-group {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            overflow: hidden;
            transition: border-color 0.2s ease;
        }

        .ficha-group:hover {
            border-color: rgba(184,150,88,0.5);
        }

        .ficha-group-title {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            padding: 12px 20px;
            font-size: 13px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: white;
        }

        .ficha-rows {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            background: rgba(255,255,255,0.02);
        }

        .ficha-row {
            display: grid;
            grid-template-columns: 1fr 1px 1fr;
            gap: 12px;
            padding: 12px 20px;
            align-items: center;
            transition: background 0.15s ease;
            min-width: 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .ficha-row:not(:last-child) {
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }

        .ficha-row:hover {
            background: rgba(255,255,255,0.04);
        }

        .ficha-label {
            font-size: 13px;
            color: var(--gold);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .ficha-separator {
            width: 1px;
            height: 20px;
            background: rgba(255,255,255,0.15);
            justify-self: center;
        }

        .ficha-value {
            font-size: 14px;
            font-weight: 500;
            color: rgba(255,255,255,0.8);
            text-align: right;
            word-wrap: break-word;
            overflow-wrap: break-word;
            min-width: 0;
        }

        /* ===== CARACTER√çSTICAS - GRID OPTIMIZADO Y EXTENDIDO ===== */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            max-width: 100%;
            margin: 0 auto;
        }

        .feature-category {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .feature-category:hover {
            border-color: rgba(184,150,88,0.5);
            background: rgba(255,255,255,0.05);
        }

        .feature-category-title {
            font-size: 13px;
            font-weight: 800;
            margin-bottom: 12px;
            color: white;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            padding: 10px 14px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .feature-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: rgba(255,255,255,0.85) !important;
            font-weight: 500;
            padding: 8px 10px;
            border-radius: 6px;
            transition: background 0.15s ease;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .feature-item:hover {
            background: rgba(255,255,255,0.08);
        }

        .feature-item::before {
            content: '';
            display: inline-flex;
            width: 6px;
            height: 6px;
            background: var(--gold);
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* Descripci√≥n */
        .description-box {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 20px;
            line-height: 1.7;
            font-size: 14px;
            color: rgba(255,255,255,0.75);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* ===== VEH√çCULOS SIMILARES - CARRUSEL HORIZONTAL ===== */
        .similar-section {
            grid-column: 1 / -1;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(255,255,255,0.1);
            min-width: 0;
            max-width: 100%;
            overflow: visible;
        }

        .similar-section h2 {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 20px;
            color: white;
            position: relative;
            border-left: 4px solid var(--gold);
            background: linear-gradient(90deg, rgba(184,150,88,0.1) 0%, transparent 100%);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
        }

        .similar-carousel-wrapper {
            position: relative;
        }

        /* Arrows inherit global .carousel-arrow style from sidebar-filters-fix.css */
        /* Only override positioning to stay inside the wrapper */
        .similar-carousel-wrapper .carousel-arrow.prev {
            left: -35px;
        }

        .similar-carousel-wrapper .carousel-arrow.next {
            right: -35px;
        }

        .similar-section .vehicles-grid {
            display: flex !important;
            flex-direction: row !important;
            gap: 16px !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            padding: 8px 4px 16px 4px !important;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .similar-section .vehicles-grid::-webkit-scrollbar {
            display: none;
        }

        .similar-section .vehicle-card {
            flex: 0 0 300px !important;
            min-width: 300px !important;
            max-width: 300px !important;
            scroll-snap-align: start;
        }

        /* Lightbox Avanzado */
        .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.97);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
            flex-direction: column;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-container {
            position: relative;
            max-width: 90vw;
            max-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 8px;
            cursor: zoom-in;
            transition: transform 0.3s ease;
            user-select: none;
        }

        .lightbox-image.zoomed {
            cursor: zoom-out;
            transform: scale(1.5);
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            color: white;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .lightbox-close:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }

        /* Navegaci√≥n del lightbox */
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .lightbox-nav:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-50%) scale(1.1);
        }

        .lightbox-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .lightbox-nav,
        .lightbox-close,
        .lightbox-dot {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .lightbox-image {
            touch-action: pan-x;
            user-select: none;
            -webkit-user-select: none;
        }

        .lightbox-prev {
            left: 20px;
        }

        .lightbox-next {
            right: 20px;
        }

        /* Contador de im√°genes en lightbox */
        .lightbox-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        /* Indicadores de puntos */
        .lightbox-dots {
            display: flex;
            gap: 8px;
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
        }

        .lightbox-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.4);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .lightbox-dot.active {
            background: white;
            transform: scale(1.2);
        }

        .lightbox-dot:hover {
            background: rgba(255,255,255,0.7);
        }

        /* Zoom indicator */
        .zoom-hint {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .lightbox.active .zoom-hint {
            opacity: 1;
            animation: fadeOutDelay 3s forwards;
        }

        @keyframes fadeOutDelay {
            0%, 70% { opacity: 1; }
            100% { opacity: 0; }
        }

        @media (max-width: 768px) {
            .lightbox-nav {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .lightbox-prev {
                left: 10px;
            }

            .lightbox-next {
                right: 10px;
            }

            .lightbox-close {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .detail-grid {
                grid-template-columns: 1fr 340px;
            }
            .features-grid {
                grid-template-columns: 1fr;
                max-width: 600px;
            }
        }

        @media (max-width: 1024px) {
            .detail-page {
                margin-top: 80px;
            }

            .detail-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .gallery-section {
                order: 0;
            }

            .info-sidebar {
                position: static;
                order: 1;
            }

            .info-card {
                padding: 16px;
            }

            /* Move action buttons above quick specs on mobile */
            .info-card {
                display: flex;
                flex-direction: column;
            }

            .vehicle-header { order: 1; }
            .price-box { order: 2; }
            .action-buttons {
                order: 3;
                margin-top: 12px;
                padding-top: 12px;
                gap: 8px;
                border-top: none;
            }
            .quick-specs { order: 4; margin-top: 12px; }

            .content-section {
                margin-top: 16px;
                padding: 16px;
                order: 2;
            }

            .similar-section { order: 3; overflow: visible; }

            .similar-section .vehicle-card {
                flex: 0 0 280px !important;
                min-width: 280px !important;
                max-width: 280px !important;
            }

            .similar-carousel-wrapper .carousel-arrow.prev { left: -10px; }
            .similar-carousel-wrapper .carousel-arrow.next { right: -10px; }

            .btn-action {
                padding: 12px 16px;
                font-size: 13px;
            }

            .btn-row .btn-action {
                padding: 10px 12px;
                font-size: 11px;
                white-space: nowrap;
                overflow: visible;
            }

            .ficha-rows {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 640px) {
            .detail-page {
                margin-top: 72px;
            }

            .detail-container {
                padding: 10px;
            }

            .detail-grid {
                gap: 10px;
            }

            .vehicle-title {
                font-size: 16px;
            }

            .ficha-row {
                grid-template-columns: 1fr;
                gap: 4px;
            }

            .ficha-separator {
                display: none;
            }

            .ficha-value {
                text-align: left;
            }

            .price-value {
                font-size: 24px;
            }

            .price-offer {
                font-size: 26px;
            }

            .main-image-container {
                border-radius: 12px;
            }

            .thumbnail {
                flex: 0 0 60px;
                height: 45px;
            }

            .action-buttons {
                margin-top: 12px;
                padding-top: 12px;
                gap: 6px;
            }

            .btn-action {
                padding: 11px 14px;
                font-size: 12px;
                gap: 8px;
            }

            .btn-action svg {
                width: 18px;
                height: 18px;
            }

            .btn-row {
                gap: 6px;
                grid-template-columns: 1fr 1fr;
            }

            .btn-row .btn-action {
                padding: 10px 8px;
                font-size: 11px;
                gap: 4px;
                white-space: nowrap;
                overflow: hidden;
                min-width: 0;
            }

            .btn-row .btn-action:last-child {
                grid-column: 1 / -1;
            }

            .btn-row .btn-action svg {
                width: 16px;
                height: 16px;
            }

            .tabs-nav {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab-btn {
                padding: 10px 14px;
                font-size: 13px;
                white-space: nowrap;
            }

            .price-normal {
                font-size: 18px;
            }

            .price-offer {
                font-size: 30px;
            }

            .quick-specs {
                grid-template-columns: 1fr;
            }

            .tabs-nav {
                overflow-x: auto;
                scrollbar-width: none;
            }

            .tabs-nav::-webkit-scrollbar {
                display: none;
            }

            .tab-btn {
                white-space: nowrap;
                flex-shrink: 0;
                padding: 12px 16px;
                font-size: 13px;
            }

            .similar-section .vehicle-card {
                flex: 0 0 260px !important;
                min-width: 260px !important;
                max-width: 260px !important;
            }

            .similar-carousel-wrapper .carousel-arrow {
                width: 42px;
                height: 42px;
            }
        }

        /* Ocultar boton flotante de WhatsApp - ya hay botones de contacto en esta pagina */
        .wa-float {
            display: none !important;
        }
    </style>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Car","name":"Chevrolet TRACKER LS 2017","brand":{"@type":"Brand","name":"Chevrolet"},"model":"TRACKER LS","vehicleModelDate":"2017","image":"https://firebasestorage.googleapis.com/v0/b/altorra-cars.firebasestorage.app/o/cars%2F1771108172890_Dise_o_sin_t_tulo__3__compressed.webp?alt=media&token=fe5b13c6-ca53-4055-bb84-3d1e205deb97","url":"https://altorracars.github.io/vehiculos/chevrolet-tracker-ls-2017-13.html","vehicleTransmission":"Mecanica","fuelType":"Gasolina","mileageFromOdometer":{"@type":"QuantitativeValue","value":63079,"unitCode":"KMT"},"color":"Plata","numberOfDoors":5,"vehicleSeatingCapacity":5,"offers":{"@type":"Offer","price":44000000,"priceCurrency":"COP","availability":"https://schema.org/InStock","seller":{"@type":"AutoDealer","name":"ALTORRA CARS","url":"https://altorracars.github.io"}}}</script>
</head>
<body>
    <div id="header-placeholder"></div>
    <noscript>
        <div style="max-width:1200px;margin:100px auto;padding:24px;font-family:sans-serif">
            <h1>Chevrolet TRACKER LS 2017</h1>
            <img src="https://firebasestorage.googleapis.com/v0/b/altorra-cars.firebasestorage.app/o/cars%2F1771108172890_Dise_o_sin_t_tulo__3__compressed.webp?alt=media&amp;token=fe5b13c6-ca53-4055-bb84-3d1e205deb97" alt="Chevrolet TRACKER LS 2017" style="max-width:100%;height:auto;border-radius:12px">
            <p style="font-size:24px;font-weight:700;color:#b89658;margin:16px 0">$¬†44.000.000</p>
            <ul style="list-style:none;padding:0;line-height:2">
                <li><strong>Tipo:</strong> Usado</li>
                <li><strong>Transmision:</strong> Mecanica</li>
                <li><strong>Combustible:</strong> Gasolina</li>
                <li><strong>Kilometraje:</strong> 63.079 km</li>
                <li><strong>Color:</strong> Plata</li>
                <li><strong>Categoria:</strong> Suv</li>
            </ul>
            <p>Motor 1.8 Litros Ecotec de 4 cilindros y 16 v√°lvulas
Cilindraje exacto de 1.796 cc
Potencia m√°xima de 138 hp a 6.200 rpm
Torque m√°ximo de 178 Nm a 3.800 rpm
Transmisi√≥n manual de 5 velocidades
Sistema de tracci√≥n delantera FWD
Direcci√≥n asistida hidr√°ulicamente</p>
            <p><a href="https://altorracars.github.io">Volver a ALTORRA CARS</a></p>
        </div>
    </noscript>

    <div class="detail-page">
        <div class="detail-container">
            <div class="detail-grid">
                <!-- Galer√≠a -->
                <div class="gallery-section">
                    <div class="main-image-container">
                        <img id="mainImage" src="" alt="Veh√≠culo" class="main-image">
                        <div class="image-counter" id="imageCounter">1/1</div>
                    </div>
                    <div class="thumbnails-grid" id="thumbnailsGrid"></div>

                </div>

                <!-- Info Sidebar -->
                <div class="info-sidebar">
                    <div class="info-card">
                        <div class="vehicle-header">
                            <div class="badges" id="badgesContainer"></div>
                            <h1 class="vehicle-title" id="vehicleTitle"></h1>
                            <p class="vehicle-subtitle" id="vehicleSubtitle"></p>
                        </div>

                        <div class="price-box">
                            <div class="price-label">Precio</div>
                            <div id="priceContainer"></div>
                        </div>

                        <div class="quick-specs" id="quickSpecs"></div>

                        <!-- Botones de Acci√≥n - Full Width Sim√©tricos -->
                        <div class="action-buttons">
                            <a href="#" id="btnWhatsApp" class="btn-action btn-whatsapp" target="_blank">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                                </svg>
                                <span>Contactar por WhatsApp</span>
                            </a>
                            <a id="btnCalculadora" href="simulador-credito.html" class="btn-action btn-calculator">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="4" y="2" width="16" height="20" rx="2"/>
                                    <line x1="8" y1="6" x2="16" y2="6"/>
                                    <line x1="8" y1="10" x2="10" y2="10"/>
                                    <line x1="14" y1="10" x2="16" y2="10"/>
                                    <line x1="8" y1="14" x2="10" y2="14"/>
                                    <line x1="14" y1="14" x2="16" y2="14"/>
                                    <line x1="8" y1="18" x2="10" y2="18"/>
                                    <line x1="14" y1="18" x2="16" y2="18"/>
                                </svg>
                                <span>Simular Cr√©dito</span>
                            </a>
                            <div class="btn-row">
                                <button id="btnComparar" class="btn-action btn-comparar">
                                    <svg id="btnCompararIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="2" y="3" width="5" height="9" rx="1"/>
                                        <rect x="9.5" y="3" width="5" height="9" rx="1"/>
                                        <rect x="17" y="3" width="5" height="9" rx="1"/>
                                        <path d="M4 15v6M12 15v6M20 15v6M2 18h4M10 18h4M18 18h4"/>
                                    </svg>
                                    <span id="btnCompararText">Comparar</span>
                                </button>
                                <button id="btnShare" class="btn-action btn-share" onclick="shareVehicle()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
                                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                    </svg>
                                    <span>Compartir</span>
                                </button>
                                <button id="btnAgendar" class="btn-action btn-agendar btn-agendar-cita">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                        <line x1="16" y1="2" x2="16" y2="6"/>
                                        <line x1="8" y1="2" x2="8" y2="6"/>
                                        <line x1="3" y1="10" x2="21" y2="10"/>
                                    </svg>
                                    <span>Agendar Visita</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Section -->
                <div class="content-section">
                    <div class="tabs-nav">
                        <button class="tab-btn active" data-tab="ficha">Ficha T√©cnica</button>
                        <button class="tab-btn" data-tab="caracteristicas">Caracter√≠sticas</button>
                        <button class="tab-btn" data-tab="descripcion">Descripci√≥n</button>
                    </div>

                    <!-- Ficha T√©cnica -->
                    <div class="tab-content active" id="tab-ficha">
                        <h2 class="section-title">Ficha T√©cnica Completa</h2>
                        <div class="ficha-table" id="fichaTable"></div>
                    </div>

                    <!-- Caracter√≠sticas -->
                    <div class="tab-content" id="tab-caracteristicas">
                        <h2 class="section-title">Caracter√≠sticas y Equipamiento</h2>
                        <div class="features-grid" id="featuresGrid"></div>
                    </div>

                    <!-- Descripci√≥n -->
                    <div class="tab-content" id="tab-descripcion">
                        <h2 class="section-title">Descripci√≥n del Veh√≠culo</h2>
                        <div class="description-box" id="descriptionBox"></div>
                    </div>
                </div>

                <!-- Veh√≠culos Similares -->
                <div class="similar-section">
                    <h2>Te puede interesar</h2>
                    <div class="similar-carousel-wrapper">
                        <button class="carousel-arrow prev" type="button" aria-label="Anterior" onclick="scrollSimilarCarousel(-1)">&#8249;</button>
                        <button class="carousel-arrow next" type="button" aria-label="Siguiente" onclick="scrollSimilarCarousel(1)">&#8250;</button>
                        <div class="vehicles-grid" id="similarVehicles"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox Avanzado -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" id="lightboxClose" aria-label="Cerrar">√ó</button>

        <button class="lightbox-nav lightbox-prev" id="lightboxPrev" aria-label="Imagen anterior">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15,18 9,12 15,6"/>
            </svg>
        </button>

        <div class="lightbox-container">
            <img id="lightboxImage" src="" alt="Imagen ampliada" class="lightbox-image">
        </div>

        <button class="lightbox-nav lightbox-next" id="lightboxNext" aria-label="Imagen siguiente">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9,18 15,12 9,6"/>
            </svg>
        </button>

        <div class="lightbox-dots" id="lightboxDots"></div>
        <div class="lightbox-counter" id="lightboxCounter">1 / 1</div>
        <div class="zoom-hint">Click para hacer zoom</div>
    </div>

    <div id="footer-placeholder"></div>

    <script src="js/firebase-config.js"></script>
    <script src="js/favorites-manager.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/components.js"></script>
    <script src="js/database.js"></script>
    <script src="js/render.js"></script>
    <script src="js/main.js"></script>
    <script src="js/comparador.js"></script>
    <script src="js/historial-visitas.js"></script>
    <script src="js/citas.js"></script>
    <script>window.PRERENDERED_VEHICLE_ID = "13";</script>
    <script>
        let currentVehicle = null;
        let currentImages = [];
        let currentImageIndex = 0;

        // Gallery Autoplay
        let galleryAutoplayInterval = null;
        const GALLERY_AUTOPLAY_DELAY = 4000; // 4 segundos

        function getVehicleIdFromURL() {
            // Pre-rendered pages embed the ID directly
            if (window.PRERENDERED_VEHICLE_ID) {
                return window.PRERENDERED_VEHICLE_ID;
            }

            // Extract ID from the last numeric segment of a slug string
            function extractIdFromSlug(slug) {
                if (!slug) return null;
                var parts = slug.split('-');
                var lastPart = parts[parts.length - 1];
                return (lastPart && /^\d+$/.test(lastPart)) ? lastPart : null;
            }

            // 1. Query param: ?v=marca-modelo-year-ID
            const params = new URLSearchParams(window.location.search);
            var slug = params.get('v');
            var idFromSlug = extractIdFromSlug(slug);
            if (idFromSlug) return idFromSlug;

            // 2. Legacy query param: ?id=N
            var legacyId = params.get('id');
            if (legacyId) return legacyId;

            // 3. Path-based: /vehiculos/marca-modelo-year-ID.html
            //    This handles direct navigation and browser refresh after replaceState
            var path = window.location.pathname;
            var pathMatch = path.match(/\/vehiculos\/(.+)\.html$/);
            if (pathMatch) {
                var pathId = extractIdFromSlug(pathMatch[1]);
                if (pathId) return pathId;
            }

            return null;
        }

        async function loadVehicleDetail() {
            const vehicleId = getVehicleIdFromURL();
            if (!vehicleId) {
                window.location.href = 'busqueda.html';
                return;
            }

            await vehicleDB.load();
            currentVehicle = vehicleDB.getVehicleById(vehicleId);

            // If not in local cache, try direct Firestore lookup
            if (!currentVehicle && window.db) {
                try {
                    var doc = await window.db.collection('vehiculos').doc(String(vehicleId)).get();
                    if (doc.exists) {
                        var data = doc.data();
                        delete data.concesionario;
                        delete data.consignaParticular;
                        currentVehicle = data;
                    }
                } catch (e) {
                    console.warn('[Detail] Direct Firestore lookup failed:', e.message);
                }
            }

            if (!currentVehicle) {
                // Show friendly "not found" instead of alert
                var container = document.querySelector('.detail-container');
                if (container) {
                    container.innerHTML = '<div style="text-align:center;padding:80px 20px;">' +
                        '<div style="font-size:3rem;margin-bottom:16px;">üîç</div>' +
                        '<h2 style="color:var(--gray-900);margin-bottom:8px;">Vehiculo no encontrado</h2>' +
                        '<p style="color:#6b7280;margin-bottom:24px;">Es posible que este vehiculo ya no este disponible o que el enlace sea incorrecto.</p>' +
                        '<a href="busqueda.html" class="btn-cta" style="display:inline-block;padding:12px 32px;background:var(--gold);color:#fff;border-radius:8px;text-decoration:none;font-weight:600;">Ver inventario disponible</a>' +
                        '</div>';
                }
                return;
            }

            renderVehicleDetail();
            updateMetaTags(currentVehicle);
            injectVehicleSchema(currentVehicle);
            loadSimilarVehicles();
            initTabs();
            initGallery();

            // Sync browser URL to SEO-canonical path (/vehiculos/slug.html)
            // so copying the URL from the address bar gives the same link as the
            // Share button ‚Äî the static page that carries pre-baked OG meta tags.
            // Uses replaceState (no page reload, no extra history entry).
            if (!window.PRERENDERED_VEHICLE_ID) {
                try {
                    var seoUrl = getShareableUrl();
                    if (seoUrl && window.location.href !== seoUrl) {
                        history.replaceState({ vehicleId: currentVehicle.id }, document.title, seoUrl);
                    }
                } catch (e) {
                    // Silent fail ‚Äî URL stays as is, page still works
                }
            }
        }

        function updateMetaTags(v) {
            const marca = capitalizar(v.marca || '');
            const modelo = v.modelo || '';
            const year = v.year || '';
            const title = marca + ' ' + modelo + ' ' + year + ' | ALTORRA CARS';
            const precio = v.precioOferta || v.precio;
            const precioText = precio ? new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 }).format(precio) : '';
            const desc = marca + ' ' + modelo + ' ' + year + ' - ' + precioText + '. ' + capitalizar(v.tipo || '') + ', ' + capitalizar(v.transmision || '') + ', ' + formatKilometers(v.kilometraje || 0) + '. Disponible en ALTORRA CARS, Cartagena.';
            const image = v.imagen || 'https://altorracars.github.io/multimedia/logo-placeholder.png';
            const fullImage = image.startsWith('http') ? image : 'https://altorracars.github.io/' + image;
            // Use shareable URL (static page with pre-baked OG tags)
            const url = getShareableUrl();

            // Update page title
            document.title = title;

            // Update meta description
            var metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) metaDesc.setAttribute('content', desc);

            // Open Graph
            var setMeta = function(id, content) {
                var el = document.getElementById(id);
                if (el) el.setAttribute('content', content);
            };
            setMeta('og-url', url);
            setMeta('og-title', title);
            setMeta('og-description', desc);
            setMeta('og-image', fullImage);
            setMeta('og-price', precio || '');
            setMeta('tw-title', title);
            setMeta('tw-description', desc);
            setMeta('tw-image', fullImage);
        }

        function injectVehicleSchema(v) {
            const marca = capitalizar(v.marca || '');
            const modelo = v.modelo || '';
            const year = v.year || '';
            const precio = v.precioOferta || v.precio;
            const image = v.imagen || '';
            const fullImage = image.startsWith('http') ? image : 'https://altorracars.github.io/' + image;
            const url = getShareableUrl();

            var schema = {
                '@context': 'https://schema.org',
                '@type': 'Car',
                'name': marca + ' ' + modelo + ' ' + year,
                'brand': { '@type': 'Brand', 'name': marca },
                'model': modelo,
                'vehicleModelDate': String(year),
                'image': fullImage,
                'url': url,
                'vehicleTransmission': capitalizar(v.transmision || ''),
                'fuelType': capitalizar(v.combustible || ''),
                'mileageFromOdometer': {
                    '@type': 'QuantitativeValue',
                    'value': v.kilometraje || 0,
                    'unitCode': 'KMT'
                },
                'color': v.color || '',
                'numberOfDoors': v.puertas || 5,
                'vehicleSeatingCapacity': v.pasajeros || 5,
                'offers': {
                    '@type': 'Offer',
                    'price': precio,
                    'priceCurrency': 'COP',
                    'availability': 'https://schema.org/InStock',
                    'seller': {
                        '@type': 'AutoDealer',
                        'name': 'ALTORRA CARS',
                        'url': 'https://altorracars.github.io'
                    }
                }
            };

            var script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(schema);
            document.head.appendChild(script);
        }

        function renderVehicleDetail() {
            const v = currentVehicle;

            // Badges
            const badges = getVehicleBadges(v);
            document.getElementById('badgesContainer').innerHTML = badges.map(b =>
                `<span class="badge ${b.class}">${b.text}</span>`
            ).join('');

            // T√≠tulo
            document.getElementById('vehicleTitle').textContent =
                `${capitalizar(v.marca)} ${v.modelo} ${v.year}`;
            document.getElementById('vehicleSubtitle').textContent =
                `${formatCategoria(v.categoria)} ‚Ä¢ ${capitalizar(v.tipo)}`;

            // Precio - con precio normal tachado si hay oferta
            const precioFinal = v.precioOferta || v.precio;
            const priceContainer = document.getElementById('priceContainer');

            if (v.precioOferta) {
                // Hay oferta: mostrar precio normal tachado y precio oferta en rojo
                priceContainer.innerHTML = `
                    <div class="price-normal">${formatCurrency(v.precio)}</div>
                    <div class="price-offer">${formatCurrency(v.precioOferta)}</div>
                `;
            } else {
                // No hay oferta: mostrar solo precio normal
                priceContainer.innerHTML = `
                    <div class="price-value">${formatCurrency(v.precio)}</div>
                `;
            }

            // Quick Specs
            const quickSpecs = [
                { label: 'A√±o', value: v.year },
                { label: 'Kilometraje', value: formatKilometers(v.kilometraje) },
                { label: 'Transmisi√≥n', value: capitalizar(v.transmision) },
                { label: 'Combustible', value: capitalizar(v.combustible) }
            ];

            document.getElementById('quickSpecs').innerHTML = quickSpecs.map(spec => `
                <div class="spec-item">
                    <div class="spec-label">${spec.label}</div>
                    <div class="spec-value">${spec.value}</div>
                </div>
            `).join('');

            // Galer√≠a
            currentImages = v.imagenes && v.imagenes.length > 0 ? v.imagenes : [v.imagen];
            renderGallery();

            // Ficha T√©cnica
            renderFichaTecnica(v);

            // Caracter√≠sticas
            renderCaracteristicas(v);

            // Descripci√≥n
            document.getElementById('descriptionBox').textContent =
                v.descripcion || 'No hay descripci√≥n disponible para este veh√≠culo.';

            // WhatsApp ‚Äî use shareable URL for proper social previews
            const currentUrl = getShareableUrl();
            // Reutilizamos precioFinal ya declarado arriba
            const whatsappMsg = `Hola ALTORRA CARS, estoy interesado en el siguiente vehiculo:

*${v.marca.toUpperCase()} ${v.modelo.toUpperCase()} ${v.year}*

INFORMACION:
- Codigo: ${v.id}
- Categoria: ${formatCategoria(v.categoria)}
- Tipo: ${capitalizar(v.tipo)}
- Ano: ${v.year}
- Kilometraje: ${formatKilometers(v.kilometraje)}
- Transmision: ${capitalizar(v.transmision)}
- Combustible: ${capitalizar(v.combustible)}
- Color: ${v.color || 'No especificado'}

PRECIO: ${formatCurrency(precioFinal)}

Ver detalle completo:
${currentUrl}

Podrian brindarme mas informacion sobre este vehiculo?`;

            document.getElementById('btnWhatsApp').href =
                `https://wa.me/573235016747?text=${encodeURIComponent(whatsappMsg)}`;

            // Configurar bot√≥n de simulador - enlace directo a simulador-credito.html con par√°metros
            const btnCalculadora = document.getElementById('btnCalculadora');
            if (btnCalculadora) {
                const params = new URLSearchParams({
                    precio: precioFinal,
                    year: v.year,
                    vehiculo: `${v.marca} ${v.modelo}`,
                    enlace: currentUrl
                });
                btnCalculadora.href = `simulador-credito.html?${params.toString()}`;
            }

            // Configurar boton comparar - usa el comparador global que sincroniza todo
            const btnComparar = document.getElementById('btnComparar');
            if (btnComparar && typeof vehicleComparator !== 'undefined') {
                // Actualizar estado inicial
                vehicleComparator.updateDetailPageButton();
                // Click handler - toggle y el comparador actualiza automaticamente
                btnComparar.onclick = () => {
                    vehicleComparator.toggle(v.id);
                };
            }

            // Configurar boton agendar visita
            const btnAgendar = document.getElementById('btnAgendar');
            if (btnAgendar) {
                btnAgendar.dataset.marca = v.marca;
                btnAgendar.dataset.modelo = v.modelo;
                btnAgendar.dataset.year = v.year;
                btnAgendar.dataset.precio = precioFinal;
            }

            document.title = `${v.marca} ${v.modelo} ${v.year} - ALTORRA CARS`;
        }

        function renderGallery() {
            document.getElementById('mainImage').src = currentImages[0];
            document.getElementById('imageCounter').textContent = `1/${currentImages.length}`;

            const thumbnailsHTML = currentImages.map((img, index) =>
                `<div class="thumbnail ${index === 0 ? 'active' : ''}" data-index="${index}">
                    <img src="${img}" alt="Vista ${index + 1}">
                </div>`
            ).join('');
            document.getElementById('thumbnailsGrid').innerHTML = thumbnailsHTML;
        }

        let isZoomed = false;
        let _lbNavigating = false; // debounce flag

        function initGallery() {
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    changeMainImage(index);
                });
            });

            document.querySelector('.main-image-container').addEventListener('click', () => {
                openLightbox(currentImageIndex);
            });

            // Lightbox controls
            document.getElementById('lightboxClose').addEventListener('click', closeLightbox);
            document.getElementById('lightboxPrev').addEventListener('click', function(e) {
                e.stopPropagation();
                navigateLightbox(-1);
            });
            document.getElementById('lightboxNext').addEventListener('click', function(e) {
                e.stopPropagation();
                navigateLightbox(1);
            });

            document.getElementById('lightbox').addEventListener('click', (e) => {
                if (e.target.id === 'lightbox') closeLightbox();
            });

            // Zoom on image click - only direct clicks, no multi-tap
            var _lastZoomTap = 0;
            document.getElementById('lightboxImage').addEventListener('click', (e) => {
                e.stopPropagation();
                if (_lbNavigating) return;
                var now = Date.now();
                if (now - _lastZoomTap < 400) return; // prevent rapid multi-tap zoom
                _lastZoomTap = now;
                toggleZoom();
            });

            // Touch gestures for mobile swipe - only on the lightbox-container (image area)
            var lbContainer = document.querySelector('.lightbox-container');
            var _lbTouchStartX = 0;
            var _lbTouchStartY = 0;
            var _lbTouchMoved = false;

            if (lbContainer) {
                lbContainer.addEventListener('touchstart', function(e) {
                    _lbTouchStartX = e.touches[0].clientX;
                    _lbTouchStartY = e.touches[0].clientY;
                    _lbTouchMoved = false;
                }, { passive: true });

                lbContainer.addEventListener('touchmove', function(e) {
                    var dx = Math.abs(e.touches[0].clientX - _lbTouchStartX);
                    var dy = Math.abs(e.touches[0].clientY - _lbTouchStartY);
                    if (dx > 10 || dy > 10) _lbTouchMoved = true;
                }, { passive: true });

                lbContainer.addEventListener('touchend', function(e) {
                    if (!_lbTouchMoved) return; // was a tap, not swipe
                    var diff = _lbTouchStartX - e.changedTouches[0].clientX;
                    if (Math.abs(diff) > 50) {
                        if (diff > 0) navigateLightbox(1);
                        else navigateLightbox(-1);
                    }
                }, { passive: true });
            }

            // Enable drag-to-scroll on thumbnails
            var thumbGrid = document.getElementById('thumbnailsGrid');
            if (thumbGrid) {
                var tDown = false, tStartX = 0, tScrollL = 0, tMoved = false;
                thumbGrid.style.cursor = 'grab';
                thumbGrid.addEventListener('mousedown', function(e) {
                    tDown = true; tMoved = false;
                    tStartX = e.clientX; tScrollL = thumbGrid.scrollLeft;
                    thumbGrid.style.cursor = 'grabbing';
                });
                thumbGrid.addEventListener('mousemove', function(e) {
                    if (!tDown) return; e.preventDefault();
                    var walk = e.clientX - tStartX;
                    thumbGrid.scrollLeft = tScrollL - walk;
                    if (Math.abs(walk) > 5) tMoved = true;
                });
                thumbGrid.addEventListener('mouseup', function() { tDown = false; thumbGrid.style.cursor = 'grab'; });
                thumbGrid.addEventListener('mouseleave', function() { tDown = false; thumbGrid.style.cursor = 'grab'; });
            }

            // ===== AUTOPLAY: Pausar al hover, reanudar al salir =====
            const gallerySection = document.querySelector('.gallery-section');
            if (gallerySection) {
                gallerySection.addEventListener('mouseenter', stopGalleryAutoplay);
                gallerySection.addEventListener('mouseleave', startGalleryAutoplay);
            }

            // Iniciar autoplay
            startGalleryAutoplay();
        }

        function changeMainImage(index) {
            currentImageIndex = index;
            document.getElementById('mainImage').src = currentImages[index];
            document.getElementById('imageCounter').textContent = `${index + 1}/${currentImages.length}`;

            document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                thumb.classList.toggle('active', i === index);
            });
        }

        // ===== GALLERY AUTOPLAY =====
        function startGalleryAutoplay() {
            if (currentImages.length <= 1) return;
            stopGalleryAutoplay();
            galleryAutoplayInterval = setInterval(() => {
                const nextIndex = (currentImageIndex + 1) % currentImages.length;
                changeMainImage(nextIndex);
            }, GALLERY_AUTOPLAY_DELAY);
        }

        function stopGalleryAutoplay() {
            if (galleryAutoplayInterval) {
                clearInterval(galleryAutoplayInterval);
                galleryAutoplayInterval = null;
            }
        }

        function openLightbox(index) {
            stopGalleryAutoplay(); // Pausar autoplay al abrir lightbox
            currentImageIndex = index;
            updateLightboxImage();
            renderLightboxDots();
            document.getElementById('lightbox').classList.add('active');
            document.body.style.overflow = 'hidden';
            isZoomed = false;
            document.getElementById('lightboxImage').classList.remove('zoomed');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
            document.body.style.overflow = 'auto';
            isZoomed = false;
            document.getElementById('lightboxImage').classList.remove('zoomed');
            startGalleryAutoplay(); // Reanudar autoplay al cerrar lightbox
        }

        function updateLightboxImage() {
            const img = document.getElementById('lightboxImage');
            img.src = currentImages[currentImageIndex];
            document.getElementById('lightboxCounter').textContent =
                `${currentImageIndex + 1} / ${currentImages.length}`;

            // Update navigation buttons
            document.getElementById('lightboxPrev').disabled = currentImageIndex === 0;
            document.getElementById('lightboxNext').disabled = currentImageIndex === currentImages.length - 1;

            // Update dots
            document.querySelectorAll('.lightbox-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentImageIndex);
            });
        }

        function navigateLightbox(direction) {
            if (_lbNavigating) return; // debounce rapid taps
            var newIndex = currentImageIndex + direction;
            if (newIndex < 0 || newIndex >= currentImages.length) return;
            _lbNavigating = true;
            currentImageIndex = newIndex;
            updateLightboxImage();

            // Reset zoom when navigating
            isZoomed = false;
            document.getElementById('lightboxImage').classList.remove('zoomed');

            // Release debounce after transition
            setTimeout(function() { _lbNavigating = false; }, 300);
        }

        function renderLightboxDots() {
            const dotsContainer = document.getElementById('lightboxDots');
            if (currentImages.length <= 1) {
                dotsContainer.innerHTML = '';
                return;
            }

            dotsContainer.innerHTML = currentImages.map((_, i) =>
                `<button class="lightbox-dot ${i === currentImageIndex ? 'active' : ''}"
                         data-index="${i}" aria-label="Ir a imagen ${i + 1}"></button>`
            ).join('');

            dotsContainer.querySelectorAll('.lightbox-dot').forEach(dot => {
                dot.addEventListener('click', () => {
                    currentImageIndex = parseInt(dot.dataset.index);
                    updateLightboxImage();
                });
            });
        }

        function toggleZoom() {
            if (_lbNavigating) return; // don't zoom during navigation
            isZoomed = !isZoomed;
            document.getElementById('lightboxImage').classList.toggle('zoomed', isZoomed);
        }

        function renderFichaTecnica(v) {
            const fichaGroups = [
                {
                    title: 'INFORMACI√ìN GENERAL',
                    items: [
                        { label: 'Marca', value: capitalizar(v.marca) },
                        { label: 'Modelo', value: v.modelo },
                        { label: 'A√±o', value: v.year },
                        { label: 'Categor√≠a', value: formatCategoria(v.categoria) },
                        { label: 'Tipo', value: capitalizar(v.tipo) },
                        { label: 'Color', value: v.color || 'No especificado' }
                    ]
                },
                {
                    title: 'MOTOR Y RENDIMIENTO',
                    items: [
                        { label: 'Motor', value: v.motor || 'No especificado' },
                        { label: 'Combustible', value: capitalizar(v.combustible) },
                        { label: 'Transmisi√≥n', value: capitalizar(v.transmision) },
                        { label: 'Cilindraje', value: v.cilindraje || 'No especificado' },
                        { label: 'Tracci√≥n', value: v.traccion || 'No especificado' },
                        { label: 'Potencia', value: v.potencia || 'No especificado' }
                    ]
                },
                {
                    title: 'DIMENSIONES Y CAPACIDAD',
                    items: [
                        { label: 'Puertas', value: v.puertas || 'No especificado' },
                        { label: 'Pasajeros', value: v.pasajeros || 'No especificado' },
                        { label: 'Asientos', value: v.asientos || v.pasajeros || 'No especificado' },
                        { label: 'Direcci√≥n', value: v.direccion || 'No especificado' }
                    ]
                },
                {
                    title: 'ESTADO Y DOCUMENTACI√ìN',
                    items: [
                        { label: 'Kilometraje', value: formatKilometers(v.kilometraje) },
                        { label: 'Placa', value: v.placa || 'Disponible al contactar' },
                        { label: 'C√≥digo Fasecolda', value: v.codigoFasecolda || 'Consultar' },
                        { label: 'Revisi√≥n T√©cnico-Mec√°nica', value: v.revisionTecnica ? 'Al d√≠a' : 'Consultar' },
                        { label: 'Peritaje', value: v.peritaje ? 'Realizado' : 'Disponible' },
                        { label: 'Ubicaci√≥n', value: v.ubicacion || 'Barranquilla' }
                    ]
                }
            ];

            document.getElementById('fichaTable').innerHTML = fichaGroups.map(group => `
                <div class="ficha-group">
                    <div class="ficha-group-title">${group.title}</div>
                    <div class="ficha-rows">
                        ${group.items.map(item => `
                            <div class="ficha-row">
                                <span class="ficha-label">${item.label}</span>
                                <div class="ficha-separator"></div>
                                <span class="ficha-value">${item.value}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderCaracteristicas(v) {
            const caracteristicasDefault = [
                'Sistema de frenos ABS',
                'Airbags frontales',
                'Aire acondicionado',
                'Direcci√≥n hidr√°ulica',
                'Cierre centralizado',
                'Vidrios el√©ctricos',
                'Espejos el√©ctricos',
                'Radio AM/FM'
            ];

            const caracteristicas = v.caracteristicas && v.caracteristicas.length > 0
                ? v.caracteristicas
                : caracteristicasDefault;

            const categorias = {
                seguridad: {
                    title: 'Seguridad',
                    keywords: ['airbag', 'abs', 'freno', 'alarma', 'bloqueo', 'sensor', 'c√°mara'],
                    items: []
                },
                confort: {
                    title: 'Confort',
                    keywords: ['aire', 'clima', 'asiento', 'calefacci√≥n', 'tapizado', 'volante'],
                    items: []
                },
                tecnologia: {
                    title: 'Tecnolog√≠a',
                    keywords: ['pantalla', 'bluetooth', 'usb', 'gps', 'navegaci√≥n', 'android', 'apple', 'radio'],
                    items: []
                },
                exterior: {
                    title: 'Exterior e Interior',
                    keywords: ['vidrio', 'espejo', 'luz', 'llanta', 'rin', 'direccion', 'cierre'],
                    items: []
                }
            };

            caracteristicas.forEach(feat => {
                const featLower = feat.toLowerCase();
                let categorized = false;

                for (const [key, cat] of Object.entries(categorias)) {
                    if (cat.keywords.some(keyword => featLower.includes(keyword))) {
                        cat.items.push(feat);
                        categorized = true;
                        break;
                    }
                }

                if (!categorized) {
                    categorias.exterior.items.push(feat);
                }
            });

            document.getElementById('featuresGrid').innerHTML = Object.values(categorias)
                .filter(cat => cat.items.length > 0)
                .map(cat => `
                    <div class="feature-category">
                        <div class="feature-category-title">${cat.title}</div>
                        <div class="feature-list">
                            ${cat.items.map(item => `
                                <div class="feature-item">${item}</div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
        }

        function initTabs() {
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;

                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                    button.classList.add('active');
                    document.getElementById(`tab-${targetTab}`).classList.add('active');
                });
            });
        }

        function loadSimilarVehicles() {
            const v = currentVehicle;
            const TARGET_MIN = 7;
            const TARGET_MAX = 12;
            const allOthers = vehicleDB.getAllVehicles().filter(veh => veh.id !== v.id && (!veh.estado || veh.estado === 'disponible'));

            // Score every vehicle by similarity
            let scored = allOthers.map(vehicle => {
                let simScore = 0;

                // Same category = highest priority (+200)
                if (vehicle.categoria === v.categoria) simScore += 200;

                // Same brand = strong match (+150)
                if (vehicle.marca === v.marca) simScore += 150;

                // Price within 20% = very relevant (+100)
                const priceDiff = Math.abs(vehicle.precio - v.precio);
                if (v.precio && priceDiff < v.precio * 0.2) simScore += 100;
                else if (v.precio && priceDiff < v.precio * 0.4) simScore += 50;

                // Year within 2 years (+80)
                const yearDiff = Math.abs(vehicle.year - v.year);
                if (yearDiff <= 2) simScore += 80;
                else if (yearDiff <= 4) simScore += 40;

                // Same type (nuevo/usado) (+60)
                if (vehicle.tipo === v.tipo) simScore += 60;

                // Same transmission (+30)
                if (vehicle.transmision === v.transmision) simScore += 30;

                // Base ranking score
                simScore += vehicleDB.calculateRankingScore(vehicle) * 0.1;

                return { ...vehicle, _simScore: simScore };
            }).sort((a, b) => b._simScore - a._simScore);

            // Take 7-12: prefer at least TARGET_MIN, cap at TARGET_MAX
            let count = Math.min(scored.length, TARGET_MAX);
            if (count < TARGET_MIN) count = Math.min(scored.length, TARGET_MIN);

            const cleanSimilar = scored.slice(0, count).map(({ _simScore, ...vehicle }) => vehicle);
            renderVehicles(cleanSimilar, 'similarVehicles');
            // Enable drag-to-scroll after rendering
            if (typeof enableDragScroll === 'function') enableDragScroll();
        }

        function scrollSimilarCarousel(direction) {
            var grid = document.getElementById('similarVehicles');
            if (!grid) return;
            var cardWidth = 316; // card width + gap
            grid.scrollBy({ left: direction * cardWidth * 2, behavior: 'smooth' });
        }
        window.scrollSimilarCarousel = scrollSimilarCarousel;

        function capitalizar(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatKilometers(km) {
            if (km === 0) return '0 km';
            return new Intl.NumberFormat('es-CO').format(km) + ' km';
        }

        function formatCategoria(cat) {
            const categorias = {
                'suv': 'SUV',
                'sedan': 'Sed√°n',
                'pickup': 'Pickup',
                'hatchback': 'Hatchback'
            };
            return categorias[cat] || capitalizar(cat);
        }

        // ===== SHARE VEHICLE =====
        // Uses static URL (vehiculos/slug.html) for sharing ‚Äî these pages have
        // pre-baked OG meta tags that social media crawlers can read
        function getShareableUrl() {
            if (!currentVehicle) return window.location.href;
            var v = currentVehicle;
            var slug = [v.marca, v.modelo, v.year, v.id]
                .filter(Boolean)
                .join('-')
                .toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');
            return window.location.origin + '/vehiculos/' + slug + '.html';
        }

        function shareVehicle() {
            if (!currentVehicle) return;
            var v = currentVehicle;
            var marca = capitalizar(v.marca || '');
            var modelo = v.modelo || '';
            var year = v.year || '';
            var precio = v.precioOferta || v.precio;
            var precioText = precio ? formatCurrency(precio) : '';
            var title = marca + ' ' + modelo + ' ' + year + ' | ALTORRA CARS';
            var text = marca + ' ' + modelo + ' ' + year + ' - ' + precioText + '\n' + capitalizar(v.tipo || '') + ' | ' + capitalizar(v.transmision || '') + ' | ' + formatKilometers(v.kilometraje || 0);
            var url = getShareableUrl();

            // Try native Web Share API first (mobile)
            if (navigator.share) {
                navigator.share({
                    title: title,
                    text: text,
                    url: url
                }).catch(function() {
                    // User cancelled or error - fallback to WhatsApp
                    shareToWhatsApp(text, url);
                });
            } else {
                // Desktop fallback - show options
                shareToWhatsApp(text, url);
            }
        }

        function shareToWhatsApp(text, url) {
            var msg = text + '\n\nVer detalle completo:\n' + url;
            var waUrl = 'https://wa.me/?text=' + encodeURIComponent(msg);
            window.open(waUrl, '_blank');
            showShareToast('Link copiado para compartir');
        }

        function showShareToast(msg) {
            var existing = document.querySelector('.share-toast');
            if (existing) existing.remove();
            var toast = document.createElement('div');
            toast.className = 'share-toast';
            toast.textContent = msg;
            document.body.appendChild(toast);
            requestAnimationFrame(function() {
                toast.classList.add('visible');
            });
            setTimeout(function() {
                toast.classList.remove('visible');
                setTimeout(function() { toast.remove(); }, 300);
            }, 2500);
        }

        // Make shareVehicle globally available
        window.shareVehicle = shareVehicle;

        document.addEventListener('DOMContentLoaded', () => {
            loadVehicleDetail().then(function() {
                // Real-time listener: auto-update if admin modifies this vehicle
                var vid = getVehicleIdFromURL();
                if (vid && window.db) {
                    window.db.collection('vehiculos').doc(String(vid))
                        .onSnapshot(function(doc) {
                            if (!doc.exists || !currentVehicle) return;
                            var updated = doc.data();
                            // Only re-render if version changed
                            if (updated._version && updated._version !== currentVehicle._version) {
                                delete updated.concesionario;
                                delete updated.consignaParticular;
                                currentVehicle = updated;
                                renderVehicleDetail();
                                updateMetaTags(currentVehicle);
                                loadSimilarVehicles();
                                initTabs();
                                initGallery();
                                showShareToast('Informacion actualizada en tiempo real');
                            }
                        });
                }
            });
        });

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('lightbox').classList.contains('active')) {
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowLeft') {
                    navigateLightbox(-1);
                }
                if (e.key === 'ArrowRight') {
                    navigateLightbox(1);
                }
                if (e.key === ' ' || e.key === 'Enter') {
                    e.preventDefault();
                    toggleZoom();
                }
            }
        });
    </script>

    <!-- Cache Manager -->
    <script src="js/cache-manager.js"></script>
</body>
</html>
