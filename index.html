<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALTORRA CARS | Venta de Autom√≥viles en Cartagena</title>
    <meta name="description" content="ALTORRA CARS - Venta de autom√≥viles nuevos y usados en Cartagena. Chevrolet, Renault, Nissan, Kia y todas las marcas.">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile-fixes.css">
    <link rel="stylesheet" href="css/featured-fixes.css">
    <link rel="stylesheet" href="css/vehicles-cards-fix.css">
<link rel="stylesheet" href="css/sidebar-filters-fix.css">
    <link rel="stylesheet" href="css/favorites-fix.css">
    <link rel="stylesheet" href="css/footer-fixes.css">
    <link rel="stylesheet" href="css/brands-fixes.css">
    <link rel="stylesheet" href="css/toast-notifications.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header Component -->
    <div id="header-placeholder"></div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1 class="hero-title">Tu Auto Ideal te Espera en Cartagena</h1>
            <p class="hero-subtitle">Nuevos y Usados ‚Ä¢ Todas las Marcas ‚Ä¢ Financiaci√≥n Disponible</p>
            
            <!-- Quick Action Buttons -->
            <div class="hero-buttons">
                <a href="vehiculos-nuevos.html" class="btn-hero btn-primary">Ver Nuevos</a>
                <a href="vehiculos-usados.html" class="btn-hero btn-secondary">Ver Usados</a>
                <a href="busqueda.html" class="btn-hero btn-outline">B√∫squeda Avanzada</a>
            </div>
        </div>
    </section>

  <!-- Featured Vehicles Section - Carrusel Destacados -->
<section class="featured-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Veh√≠culos <span class="highlight">Destacados</span></h2>
      <a href="busqueda.html" class="btn-view-more">Ver todos ‚Üí</a>
    </div>

    <div class="carousel-wrapper">
      <!-- Flechas del carrusel -->
      <button class="carousel-arrow prev" type="button" aria-label="Anterior" onclick="scrollCarouselById('featuredVehicles', -1)">‚Äπ</button>
      <button class="carousel-arrow next" type="button" aria-label="Siguiente" onclick="scrollCarouselById('featuredVehicles', 1)">‚Ä∫</button>

      <div class="vehicles-grid" id="featuredVehicles">
        <!-- Vehicles will be loaded dynamically -->
      </div>
    </div>
    <p class="carousel-hint">üëâ Desliza para ver m√°s</p>
  </div>
</section>

    <!-- Carrusel Veh√≠culos Usados -->
    <section class="featured-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Veh√≠culos <span class="highlight">Usados</span></h2>
                <a href="vehiculos-usados.html" class="btn-view-more">Ver todos ‚Üí</a>
            </div>

            <div class="carousel-wrapper">
                <!-- Flechas del carrusel -->
                <button class="carousel-arrow prev" type="button" aria-label="Anterior" onclick="scrollCarouselById('usedVehiclesCarousel', -1)">‚Äπ</button>
                <button class="carousel-arrow next" type="button" aria-label="Siguiente" onclick="scrollCarouselById('usedVehiclesCarousel', 1)">‚Ä∫</button>

                <div class="vehicles-grid" id="usedVehiclesCarousel">
                    <!-- Vehicles will be loaded dynamically -->
                </div>
            </div>
            <p class="carousel-hint">üëâ Desliza para ver m√°s</p>
        </div>
    </section>

    <!-- Carrusel Veh√≠culos Nuevos -->
    <section class="featured-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Veh√≠culos <span class="highlight">Nuevos</span></h2>
                <a href="vehiculos-nuevos.html" class="btn-view-more">Ver todos ‚Üí</a>
            </div>

            <div class="carousel-wrapper">
                <!-- Flechas del carrusel -->
                <button class="carousel-arrow prev" type="button" aria-label="Anterior" onclick="scrollCarouselById('newVehiclesCarousel', -1)">‚Äπ</button>
                <button class="carousel-arrow next" type="button" aria-label="Siguiente" onclick="scrollCarouselById('newVehiclesCarousel', 1)">‚Ä∫</button>

                <div class="vehicles-grid" id="newVehiclesCarousel">
                    <!-- Vehicles will be loaded dynamically -->
                </div>
            </div>
            <p class="carousel-hint">üëâ Desliza para ver m√°s</p>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section">
        <div class="container">
            <h2 class="section-title">Busca por <span class="highlight">Categor√≠a</span></h2>
            <div class="categories-grid">
                <a href="vehiculos-suv.html" class="category-card">
                    <div class="category-image">
                        <img src="multimedia/categories/suv.jpg" alt="SUV / Crossover" loading="lazy">
                    </div>
                    <h3 class="category-name">SUV / Crossover</h3>
                </a>

                <a href="vehiculos-pickup.html" class="category-card">
                    <div class="category-image">
                        <img src="multimedia/categories/camioneta.jpg" alt="Pickup (Trabajo)" loading="lazy">
                    </div>
                    <h3 class="category-name">Pickup (Trabajo)</h3>
                </a>

                <a href="vehiculos-sedan.html" class="category-card">
                    <div class="category-image">
                        <img src="multimedia/categories/sedan.jpg" alt="Sed√°n" loading="lazy">
                    </div>
                    <h3 class="category-name">Sed√°n</h3>
                </a>

                <a href="vehiculos-hatchback.html" class="category-card">
                    <div class="category-image">
                        <img src="multimedia/categories/hatchback.jpg" alt="Hatchback / Compacto" loading="lazy">
                    </div>
                    <h3 class="category-name">Hatchback / Compacto</h3>
                </a>
            </div>
        </div>
    </section>

    <!-- Popular Brands Section - FASE 2: Con logos din√°micos -->
    <section class="brands-section">
        <div class="container">
            <h2 class="section-title">Marcas <span class="highlight">Populares</span></h2>
            <div class="brands-grid" id="popularBrands">
                <!-- Brands will be loaded dynamically -->
            </div>
            <div class="text-center mt-3">
                <a href="busqueda.html" class="btn-view-more">Ver todas las marcas ‚Üí</a>
            </div>
        </div>
    </section>

    <!-- Commercial Section - Compra / Vende / Financia -->
    <section class="commercial-section">
        <div class="container">
            <div class="commercial-header">
                <h2 class="commercial-title">Todo en un <span class="highlight">Solo Lugar</span></h2>
                <p class="commercial-subtitle">Soluciones integrales para tu movilidad en Cartagena</p>
            </div>

            <!-- Servicios Comerciales -->
            <div class="commercial-grid">
                <div class="commercial-card">
                    <div class="commercial-number">01</div>
                    <h3 class="commercial-card-title">Compra tu Auto</h3>
                    <p class="commercial-card-text">Encuentra el veh√≠culo perfecto entre nuestra amplia selecci√≥n certificada y garantizada.</p>
                    <a href="busqueda.html" class="btn-commercial">VER INVENTARIO</a>
                </div>
                <div class="commercial-card">
                    <div class="commercial-number">02</div>
                    <h3 class="commercial-card-title">Vende tu Auto</h3>
                    <p class="commercial-card-text">Recibe la mejor oferta del mercado. Aval√∫o r√°pido, transparente y seguro.</p>
                    <a href="https://wa.me/573235016747?text=Hola%20ALTORRA%20CARS,%20quiero%20vender%20mi%20veh√≠culo" class="btn-commercial" target="_blank">COTIZAR AHORA</a>
                </div>
                <div class="commercial-card">
                    <div class="commercial-number">03</div>
                    <h3 class="commercial-card-title">Financiaci√≥n</h3>
                    <p class="commercial-card-text">Contamos con aliados estrat√©gicos financieros para ofrecerte las mejores opciones de cr√©dito.</p>
                    <a href="https://wa.me/573235016747?text=Hola%20ALTORRA%20CARS,%20necesito%20informaci√≥n%20sobre%20financiaci√≥n" class="btn-commercial" target="_blank">SOLICITAR INFO</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Component -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="js/favorites-manager.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/components.js"></script>
    <script src="js/database.js"></script>
    <script src="js/render.js"></script>
    <script src="js/main.js"></script>
    <script>
        // FASE 2: Load featured vehicles with advanced ranking
        async function loadFeatured() {
            showLoading('featuredVehicles');
            await vehicleDB.load();
            // CORREGIDO: Filtrar primero por destacados, luego rankear
            const featured = vehicleDB.getFeatured();
            // Rankear los destacados por oferta, tipo, a√±o, km
            const rankedFeatured = featured.map(v => ({
                ...v,
                _score: vehicleDB.calculateRankingScore(v)
            })).sort((a, b) => b._score - a._score);
            const cleanFeatured = rankedFeatured.map(({ _score, ...v }) => v);
            renderVehicles(cleanFeatured.slice(0, 12), 'featuredVehicles');
        }

        // FASE 2: Load popular brands dynamically (real by inventory count)
        async function loadPopularBrands() {
            await vehicleDB.load();
            const allVehicles = vehicleDB.getAllVehicles();

            // Count vehicles by brand
            const brandCounts = {};
            allVehicles.forEach(v => {
                const brandKey = v.marca.toLowerCase();
                brandCounts[brandKey] = (brandCounts[brandKey] || 0) + 1;
            });

            // Get all brands and sort by vehicle count
            const brands = vehicleDB.getAllBrands();
            const popularBrands = brands
                .filter(brand => brandCounts[brand.id] > 0) // Only brands with vehicles
                .map(brand => ({
                    ...brand,
                    count: brandCounts[brand.id]
                }))
                .sort((a, b) => b.count - a.count) // Sort by count descending
                .slice(0, 12); // Top 12

            const container = document.getElementById('popularBrands');

            if (container) {
                const html = popularBrands.map(brand => `
                    <a href="marca.html?marca=${brand.id}" class="brand-card">
                        <img src="${brand.logo}" alt="${brand.nombre}" class="brand-logo"
                             onerror="this.style.display='none'">
                        <div class="brand-name">${brand.nombre}</div>
                    </a>
                `).join('');

                container.innerHTML = html;
            }
        }

        // FASE 2: Load new vehicles with ranking (year desc - newest first)
        async function loadNewVehicles() {
            showLoading('newVehiclesCarousel');
            await vehicleDB.load();
            const newVehicles = vehicleDB.filter({ tipo: 'nuevo' });

            // Sort: destacado > oferta > year (desc)
            const sortedNew = newVehicles.sort((a, b) => {
                // Destacados first
                if (a.destacado && !b.destacado) return -1;
                if (!a.destacado && b.destacado) return 1;

                // Ofertas second
                if (a.oferta && !b.oferta) return -1;
                if (!a.oferta && b.oferta) return 1;

                // Then by year (newest first)
                return b.year - a.year;
            });

            renderVehicles(sortedNew.slice(0, 12), 'newVehiclesCarousel');
        }

        // FASE 2: Load used vehicles with ranking (year desc, then km asc)
        async function loadUsedVehicles() {
            showLoading('usedVehiclesCarousel');
            await vehicleDB.load();
            const used = vehicleDB.filter({ tipo: 'usado' });

            // Sort: destacado > oferta > year (desc) > km (asc - less is better)
            const sortedUsed = used.sort((a, b) => {
                // Destacados first
                if (a.destacado && !b.destacado) return -1;
                if (!a.destacado && b.destacado) return 1;

                // Ofertas second
                if (a.oferta && !b.oferta) return -1;
                if (!a.oferta && b.oferta) return 1;

                // Then by year (newest first)
                if (b.year !== a.year) return b.year - a.year;

                // Finally by km (less km is better)
                return a.kilometraje - b.kilometraje;
            });

            renderVehicles(sortedUsed.slice(0, 12), 'usedVehiclesCarousel');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadFeatured();
            loadPopularBrands();
            loadUsedVehicles();
            loadNewVehicles();
        });
    </script>
    <script>
// Funci√≥n unificada para scroll de carruseles
function scrollCarouselById(containerId, direction) {
    const grid = document.getElementById(containerId);
    if (!grid) {
        console.error('Carousel not found:', containerId);
        return;
    }

    // Calcular ancho de scroll basado en las tarjetas visibles
    const cardWidth = 350; // Ancho aprox de cada tarjeta + gap
    const scrollAmount = cardWidth * 3; // Scroll de 3 tarjetas a la vez

    grid.scrollBy({
        left: direction * scrollAmount,
        behavior: 'smooth'
    });
}

// Mejorar scroll t√°ctil en m√≥vil para carruseles
function enableTouchScroll() {
    const carousels = document.querySelectorAll('.vehicles-grid');

    carousels.forEach(carousel => {
        let startX = 0;
        let scrollLeft = 0;
        let isScrolling = false;

        // Prevenir interferencias en m√≥vil
        carousel.style.cursor = 'default';

        // No interferir con el scroll nativo, solo asegurar que funcione
        carousel.addEventListener('touchstart', (e) => {
            isScrolling = true;
            startX = e.touches[0].pageX - carousel.offsetLeft;
            scrollLeft = carousel.scrollLeft;
        }, { passive: true });

        carousel.addEventListener('touchend', () => {
            isScrolling = false;
        }, { passive: true });
    });
}

// Inicializar mejoras t√°ctiles cuando cargue la p√°gina
document.addEventListener('DOMContentLoaded', () => {
    enableTouchScroll();
});
</script>
</body>
</html>
