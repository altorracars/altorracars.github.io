<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Subir datos a Firestore | ALTORRA CARS</title>
    <meta name="robots" content="noindex, nofollow">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: #0a0a0a; color: #e8e8e8; padding: 2rem; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #d4af37; margin-bottom: 1rem; }
        h2 { color: #b89658; margin: 1.5rem 0 0.5rem; }
        .status { padding: 1rem; border-radius: 8px; margin: 1rem 0; font-family: monospace; font-size: 0.9rem; max-height: 400px; overflow-y: auto; background: #1a1a1a; border: 1px solid #333; }
        .status p { margin: 0.25rem 0; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
        .warning { color: #ff9800; }
        button { padding: 0.75rem 2rem; font-size: 1rem; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 0.5rem 0.5rem 0.5rem 0; }
        .btn-primary { background: #d4af37; color: #0a0a0a; }
        .btn-primary:hover { background: #b89658; }
        .btn-primary:disabled { background: #555; color: #999; cursor: not-allowed; }
        .btn-danger { background: #f44336; color: #fff; }
        .btn-danger:hover { background: #d32f2f; }
        .counter { display: inline-block; padding: 0.5rem 1rem; background: #1a1a1a; border: 1px solid #d4af37; border-radius: 8px; margin: 0.5rem 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ALTORRA CARS - Admin Upload</h1>
        <p>Esta pagina sube los datos de <code>vehiculos.json</code> a Firestore.</p>

        <h2>Estado de Firebase</h2>
        <div id="firebaseStatus" class="counter">Conectando...</div>

        <h2>Subir Datos</h2>
        <button id="btnUploadVehicles" class="btn-primary" disabled>Subir Vehiculos a Firestore</button>
        <button id="btnUploadBrands" class="btn-primary" disabled>Subir Marcas a Firestore</button>

        <h2>Log</h2>
        <div id="log" class="status"></div>
    </div>

    <script src="js/firebase-config.js"></script>
    <script>
        var logEl = document.getElementById('log');
        var btnVehicles = document.getElementById('btnUploadVehicles');
        var btnBrands = document.getElementById('btnUploadBrands');
        var statusEl = document.getElementById('firebaseStatus');

        function log(msg, type) {
            var p = document.createElement('p');
            p.className = type || 'info';
            p.textContent = msg;
            logEl.appendChild(p);
            logEl.scrollTop = logEl.scrollHeight;
        }

        // Wait for Firebase
        window.firebaseReady.then(function(result) {
            if (result && result.db) {
                statusEl.textContent = 'Firebase + Firestore conectados';
                statusEl.style.borderColor = '#4caf50';
                btnVehicles.disabled = false;
                btnBrands.disabled = false;
                log('Firebase listo. Puedes subir los datos.', 'success');
            } else {
                statusEl.textContent = 'Error al conectar';
                statusEl.style.borderColor = '#f44336';
                log('No se pudo conectar a Firebase', 'error');
            }
        });

        // Upload vehicles
        btnUploadVehicles.addEventListener('click', function() {
            btnVehicles.disabled = true;
            log('Cargando vehiculos.json...', 'info');

            fetch('data/vehiculos.json')
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    var vehicles = data.vehiculos || [];
                    log('Encontrados ' + vehicles.length + ' vehiculos. Subiendo...', 'info');

                    var batch = window.db.batch();
                    vehicles.forEach(function(vehicle) {
                        var docRef = window.db.collection('vehiculos').doc(String(vehicle.id));
                        batch.set(docRef, vehicle);
                    });

                    return batch.commit().then(function() {
                        return vehicles.length;
                    });
                })
                .then(function(count) {
                    log(count + ' vehiculos subidos exitosamente a Firestore!', 'success');
                    btnVehicles.disabled = false;
                })
                .catch(function(error) {
                    log('Error: ' + error.message, 'error');
                    btnVehicles.disabled = false;
                });
        });

        // Upload brands
        btnUploadBrands.addEventListener('click', function() {
            btnBrands.disabled = true;
            log('Cargando marcas desde vehiculos.json...', 'info');

            fetch('data/vehiculos.json')
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    var brands = data.marcas || [];
                    log('Encontradas ' + brands.length + ' marcas. Subiendo...', 'info');

                    var batch = window.db.batch();
                    brands.forEach(function(brand) {
                        var docRef = window.db.collection('marcas').doc(brand.id);
                        batch.set(docRef, brand);
                    });

                    return batch.commit().then(function() {
                        return brands.length;
                    });
                })
                .then(function(count) {
                    log(count + ' marcas subidas exitosamente a Firestore!', 'success');
                    btnBrands.disabled = false;
                })
                .catch(function(error) {
                    log('Error: ' + error.message, 'error');
                    btnBrands.disabled = false;
                });
        });
    </script>
</body>
</html>
